<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ì‹œê°„ ì»¨íŒ ëŒ€ê¸°ì—´</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        body { font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif; background-color: #f4f7f6; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { background-color: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 100%; max-width: 650px; }
        h2 { text-align: center; color: #333; margin-bottom: 20px; }
        
        /* ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .noti-box { text-align: center; margin-bottom: 20px; }
        #notiBtn { 
            background-color: #6c757d; color: white; border: none; padding: 10px 20px; 
            border-radius: 20px; cursor: pointer; font-size: 14px; transition: 0.3s; 
        }
        #notiBtn.active { background-color: #0d6efd; font-weight: bold; }
        #notiBtn:hover { opacity: 0.9; }

        .form-group { display: flex; gap: 10px; margin-bottom: 20px; }
        input { padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
        input#name { width: 25%; }
        input#content { width: 60%; }
        .btn-submit { width: 15%; padding: 12px; background-color: #2b2d42; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-submit:hover { background-color: #1a1b2e; }
        .queue-list { list-style: none; padding: 0; margin: 0; }
        .queue-item { background-color: #f8f9fa; border-left: 5px solid #8d99ae; padding: 15px; margin-bottom: 10px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s ease; }
        
        /* í˜¸ì¶œ ì‹œ ë¦¬ìŠ¤íŠ¸ ê¹œë¹¡ì„ íš¨ê³¼ */
        @keyframes blinkWarning {
            0% { background-color: #fff3cd; border-left-color: #ffc107; }
            50% { background-color: #ffe69c; border-left-color: #fd7e14; }
            100% { background-color: #fff3cd; border-left-color: #ffc107; }
        }
        .queue-item.calling { animation: blinkWarning 1.5s infinite; }
        .queue-item.calling .queue-status { color: #d32f2f; font-weight: bold; }
        .queue-info { flex-grow: 1; }
        .queue-info strong { display: inline-block; width: 60px; color: #2b2d42; }
        .queue-time { font-size: 12px; color: #888; margin-top: 5px; display: block; }
        .action-buttons { display: flex; gap: 8px; }
        button { padding: 8px 12px; font-size: 13px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-call { background-color: #ffb703; color: #023047; }
        .btn-call:hover { background-color: #fb8500; }
        .btn-done { background-color: #8d99ae; color: white; }
        .btn-done:hover { background-color: #717b8c; }
        .empty-msg { text-align: center; color: #888; padding: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“ ì‹¤ì‹œê°„ ëŒ€í‘œë‹˜ ì»¨íŒ ëŒ€ê¸°ì—´</h2>
    
    <div class="noti-box">
        <button id="notiBtn" onclick="requestPermission()">ğŸ”” PC ì•Œë¦¼ ê¶Œí•œ ì¼œê¸° (í´ë¦­í•´ì£¼ì„¸ìš”)</button>
    </div>

    <form class="form-group" id="confirmForm">
        <input type="text" id="name" placeholder="ì´ë¦„" required>
        <input type="text" id="content" placeholder="ì˜ˆ: í˜œì›€ í‰ë©´ë„, ì´ì²œ ë°”ë””ì¦ˆ ìƒ˜í”Œë³´ë“œ ë“±" required>
        <button type="submit" class="btn-submit">ë“±ë¡</button>
    </form>

    <ul class="queue-list" id="queueList"></ul>
</div>

<script>
    // íšŒì›ë‹˜ì˜ Firebase ì„¤ì • (ìˆ˜ì • ì™„ë£Œë¨)
// ğŸš¨ ì—¬ê¸°ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”! (databaseURL ì¤„ì´ ê¼­ ìˆì–´ì•¼ í•©ë‹ˆë‹¤)
    const firebaseConfig = {
        apiKey: "AIzaSyBZmxJUr5oaZttF7oIYJSEBb5RgjVQjInY",
        authDomain: "cofirm-board.firebaseapp.com",
        databaseURL: "https://cofirm-board-default-rtdb.firebaseio.com", // ğŸ‘ˆ ì´ ì¤„ì´ ìˆëŠ”ì§€ ê¼­ í™•ì¸!!
        projectId: "cofirm-board",
        storageBucket: "cofirm-board.firebasestorage.app",
        messagingSenderId: "367825644618",
        appId: "1:367825644618:web:3f236c72c07d5347878ab3",
        measurementId: "G-N4QY18DHPX"
    };

    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.database();
    const queueRef = db.ref('confirm_queue');

    const form = document.getElementById('confirmForm');
    const queueList = document.getElementById('queueList');
    
    // ì´ì „ì— í˜¸ì¶œ ì¤‘ì´ì—ˆëŠ”ì§€ ê¸°ì–µí•˜ëŠ” ë³€ìˆ˜ (ì¤‘ë³µ ì•Œë¦¼ ë°©ì§€ìš©)
    let wasCalling = false;

    // ğŸ”” 2. ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ í•¨ìˆ˜
    function requestPermission() {
        Notification.requestPermission().then(permission => {
            const btn = document.getElementById('notiBtn');
            if (permission === 'granted') {
                btn.innerText = "âœ… ì•Œë¦¼ ê¸°ëŠ¥ì´ ì¼œì¡ŒìŠµë‹ˆë‹¤!";
                btn.classList.add('active');
                // í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ë°œì†¡
                new Notification("ì•Œë¦¼ í…ŒìŠ¤íŠ¸ ì„±ê³µ!", { body: "ëŒ€í‘œë‹˜ì´ í˜¸ì¶œí•˜ì‹œë©´ ì´ë ‡ê²Œ ì•Œë¦¼ì´ ëœ¹ë‹ˆë‹¤." });
            } else {
                alert("ë¸Œë¼ìš°ì € ì£¼ì†Œì°½ ì˜†ì˜ 'ìë¬¼ì‡ ' ì•„ì´ì½˜ì„ ëˆŒëŸ¬ ì•Œë¦¼ì„ í—ˆìš©í•´ì£¼ì„¸ìš”!");
            }
        });
    }
    
    // í˜ì´ì§€ ë¡œë“œì‹œ ê¶Œí•œ ìƒíƒœ ì²´í¬
    if (Notification.permission === 'granted') {
        const btn = document.getElementById('notiBtn');
        btn.innerText = "âœ… ì•Œë¦¼ ê¸°ëŠ¥ì´ ì¼œì ¸ìˆìŠµë‹ˆë‹¤";
        btn.classList.add('active');
    }

    // ğŸ”„ ì‹¤ì‹œê°„ ë°ì´í„° ê°ì‹œ
    queueRef.on('value', (snapshot) => {
        queueList.innerHTML = '';
        const data = snapshot.val();
        
        let isNowCalling = false; // ì§€ê¸ˆ í˜¸ì¶œ ì¤‘ì¸ ì‚¬ëŒì´ ìˆëŠ”ê°€?

        if (!data) {
            queueList.innerHTML = '<li class="empty-msg">í˜„ì¬ ëŒ€ê¸° ì¤‘ì¸ ì»¨íŒì´ ì—†ìŠµë‹ˆë‹¤. â˜•</li>';
            wasCalling = false;
            return;
        }

        let index = 1;
        for (let key in data) {
            const item = data[key];
            const li = document.createElement('li');
            
            li.className = item.status === 'calling' ? 'queue-item calling' : 'queue-item';
            
            if (item.status === 'calling') {
                isNowCalling = true;
                // ë‚´ê°€ í˜¸ì¶œ ëŒ€ìƒì¸ì§€ í™•ì¸ (ì´ë¦„ í¬í•¨)
                if (!wasCalling) {
                    sendNotification(item.name, item.content);
                }
            }

            const statusText = item.status === 'calling' ? 'ğŸš¨ ëŒ€í‘œë‹˜ í˜¸ì¶œ ì¤‘!' : 'ëŒ€ê¸° ì¤‘';
            const callBtnText = item.status === 'calling' ? 'í˜¸ì¶œ ì·¨ì†Œ' : 'í˜¸ì¶œ (ëŒ€í‘œë‹˜)';

            li.innerHTML = `
                <div class="queue-info">
                    <span class="queue-number"><strong>#${index}</strong> ${item.name}</span>
                    <span class="queue-status" style="font-size: 12px; margin-left: 10px;">[${statusText}]</span><br>
                    <span style="display:inline-block; margin-top:5px;">${item.content}</span>
                    <span class="queue-time">${item.time} ì‹ ì²­</span>
                </div>
                <div class="action-buttons">
                    <button class="btn-call" onclick="toggleCall('${key}', '${item.status}')">${callBtnText}</button>
                    <button class="btn-done" onclick="completeConfirm('${key}')">ì™„ë£Œ</button>
                </div>
            `;
            queueList.appendChild(li);
            index++;
        }
        
        // ìƒíƒœ ì—…ë°ì´íŠ¸
        wasCalling = isNowCalling;
    });

    // ğŸ”” 3. ìœˆë„ìš° ì•Œë¦¼ ë³´ë‚´ê¸° í•¨ìˆ˜
    function sendNotification(name, content) {
        if (Notification.permission === 'granted') {
            const notification = new Notification("ğŸš¨ ëŒ€í‘œë‹˜ í˜¸ì¶œ ë°œìƒ!", {
                body: `${name}ë‹˜! ì»¨íŒ ë°›ìœ¼ëŸ¬ ì˜¤ì„¸ìš”.\n(${content})`,
                icon: "https://cdn-icons-png.flaticon.com/512/10308/10308979.png", // ì•Œë¦¼ ì•„ì´ì½˜
                requireInteraction: true // ì‚¬ìš©ìê°€ ë‹«ì„ ë•Œê¹Œì§€ ì•Œë¦¼ ìœ ì§€
            });
            
            // ì•Œë¦¼ í´ë¦­ ì‹œ í•´ë‹¹ ì°½ìœ¼ë¡œ ì´ë™
            notification.onclick = function() {
                window.focus();
                this.close();
            };
        }
    }

    // ë“±ë¡ ê¸°ëŠ¥
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        const nameInput = document.getElementById('name');
        const contentInput = document.getElementById('content');

        queueRef.push({
            name: nameInput.value,
            content: contentInput.value,
            time: new Date().toLocaleTimeString('ko-KR'),
            status: "waiting"
        });
        
        nameInput.value = '';
        contentInput.value = '';
    });

    // ìƒíƒœ ë³€ê²½
    window.toggleCall = function(key, currentStatus) {
        const newStatus = currentStatus === 'waiting' ? 'calling' : 'waiting';
        queueRef.child(key).update({ status: newStatus });
    }

    // ì™„ë£Œ ì‚­ì œ
    window.completeConfirm = function(key) {
        queueRef.child(key).remove();
    }
</script>

</body>
</html>

